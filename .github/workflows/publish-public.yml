- name: Prepare public folder (whitelist copy)
  run: |
    set -e
    mkdir -p public

    copy_dir_if_exists() { [ -d "$1" ] && mkdir -p "$(dirname "public/$1")" && cp -R "$1" "public/$1"; }
    copy_file_if_exists() { [ -f "$1" ] && cp "$1" public/; }

    # Root files (only the safe ones)
    for f in App.jsx Main.jsx index.js app.json babel.config.js metro.config.js react-native.config.js jest.config.js; do
      [ -f "$f" ] && cp "$f" public/
    done

    # src/ whitelist
    copy_dir_if_exists src/KQ-UI
    copy_dir_if_exists src/components
    copy_dir_if_exists src/hooks
    copy_dir_if_exists src/redux/reducers
    copy_dir_if_exists src/screens
    copy_dir_if_exists src/utilities
    copy_dir_if_exists src/styles

    # Remove private subtrees we don't want
    rm -rf public/src/utilities/realtime || true
    rm -rf public/src/svg || true
    rm -rf public/src/images || true
